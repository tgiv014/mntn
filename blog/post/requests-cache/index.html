<!DOCTYPE html><html lang="en"><head><meta name="generator" content="React Static"/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, shrink-to-fit=no"/><link rel="preload" as="script" href="/templates/styles.3592562f.js"/><link rel="preload" as="script" href="/templates/vendors~main.b60da2e7.js"/><link rel="preload" as="script" href="/main.e9e3ebf8.js"/><link rel="preload" as="style" href="/styles.9d2f3657.css"/><link rel="stylesheet" href="/styles.9d2f3657.css"/></head><body><div id="root"><div style="outline:none" tabindex="-1"><nav><div class="wrapper"><div class="header-wrapper"><div class="header-col"><a href="/"><svg class="logo-container" viewBox="0 0 12.4355 5.8209889"><g transform="translate(-1.0582919,-1.0582557)"><path class="logo" d="m 1.9843752,5.953161 3.96875,-3.9688494 2.6458334,2.6458994 1.3229163,-1.32295 2.6458331,2.6459" id="path862"></path></g></svg></a></div><div class="header-col"><a href="/about">About</a><a href="/blog">Blog</a></div></div></div></nav><div class="content"><div class="wrapper"><div style="outline:none" tabindex="-1"><div><div class="backline"><a href="/blog/"><h1>&lt;</h1></a><h1>Faster Backtesting with requests-cache</h1></div><br/><em>Wed Feb 03 2021</em><div><h1>The Problem</h1>
<p>Lately, I've been playing with algorithmic trading using <a href="https://www.backtrader.com/">Backtrader</a>, which is a spectacular tool for experimenting with algorithmic trading strategies. This hobby could be considered a problem in itself, but that's not today's topic. A strategy I've been testing involves maintaining a list of S&#x26;P500 stocks, ranking them by some metrics, and making a portfolio out of the top 20% or so. Essentially, a really impersonal buy-and-hold strategy.</p>
<p>Unfortunately, this means I need to collect data on 500 stocks over my backtesting time range (5+ years). I would really prefer to use Backtrader's automatic Yahoo Finance data source <code>bt.feeds.YahooFinanceData</code>, but I don't want to send 500+ requests to Yahoo every time I tweak a single variable. On a list of just 16 stocks, it takes ~40 seconds to query 5 years of data and run the strategy. There has to be a better way.</p>
<h1>Enter <code>requests-cache</code>!</h1>
<p>Backtrader supports proxies (so we could set up a caching proxy), but under the hood, backtrader's <a href="https://github.com/mementum/backtrader/blob/master/backtrader/feeds/yahoo.py">Yahoo feed</a> uses the <code>requests</code> module! This means we can solve our problem without even touching a proxy service or having to set up local SSL certificates to cache HTTPS.</p>
<p>All we need to do is run <code>pip install requests-cache</code> and add two lines of code to the start of our Backtrader script.</p>
<pre><code class="language-python">import requests_cache
requests_cache.install_cache('test_cache', expire_after=3600)
</code></pre>
<p>Now, requests-cache will automatically cache any requests made via the python <code>request</code> module in a file called <code>test_cache.sqlite</code>. Even HTTPS. With this little change, backtesting against 16 stocks over 5 years finishes in 10 seconds: an improvement of 75%!</p>
</div><br/></div></div></div></div><footer><div class="wrapper"><div class="footer-wrapper"><div class="footer-col"><ul class="dotless-list"><li>mntn.dev</li><li>Â© Thomas Gorham 2021</li></ul></div><div class="footer-col"><ul class="dotless-list"><li><a href="/colophon">Colophon</a></li></ul></div></div></div></footer></div></div><script type="text/javascript">window.__routeInfo = JSON.parse("{\"template\":\"__react_static_root__/src/containers/Post\",\"sharedHashesByProp\":{},\"data\":{\"html\":{\"__html\":\"<h1>The Problem</h1>\\n<p>Lately, I've been playing with algorithmic trading using <a href=\\\"https://www.backtrader.com/\\\">Backtrader</a>, which is a spectacular tool for experimenting with algorithmic trading strategies. This hobby could be considered a problem in itself, but that's not today's topic. A strategy I've been testing involves maintaining a list of S&#x26;P500 stocks, ranking them by some metrics, and making a portfolio out of the top 20% or so. Essentially, a really impersonal buy-and-hold strategy.</p>\\n<p>Unfortunately, this means I need to collect data on 500 stocks over my backtesting time range (5+ years). I would really prefer to use Backtrader's automatic Yahoo Finance data source <code>bt.feeds.YahooFinanceData</code>, but I don't want to send 500+ requests to Yahoo every time I tweak a single variable. On a list of just 16 stocks, it takes ~40 seconds to query 5 years of data and run the strategy. There has to be a better way.</p>\\n<h1>Enter <code>requests-cache</code>!</h1>\\n<p>Backtrader supports proxies (so we could set up a caching proxy), but under the hood, backtrader's <a href=\\\"https://github.com/mementum/backtrader/blob/master/backtrader/feeds/yahoo.py\\\">Yahoo feed</a> uses the <code>requests</code> module! This means we can solve our problem without even touching a proxy service or having to set up local SSL certificates to cache HTTPS.</p>\\n<p>All we need to do is run <code>pip install requests-cache</code> and add two lines of code to the start of our Backtrader script.</p>\\n<pre><code class=\\\"language-python\\\">import requests_cache\\nrequests_cache.install_cache('test_cache', expire_after=3600)\\n</code></pre>\\n<p>Now, requests-cache will automatically cache any requests made via the python <code>request</code> module in a file called <code>test_cache.sqlite</code>. Even HTTPS. With this little change, backtesting against 16 stocks over 5 years finishes in 10 seconds: an improvement of 75%!</p>\\n\"},\"post\":{\"fname\":\"requests-cache.md\",\"data\":{\"title\":\"Faster Backtesting with requests-cache\",\"date\":\"2021-02-03 00:00:00 -0500\",\"categories\":\"code\"},\"md\":\"<h1>The Problem</h1>\\n<p>Lately, I've been playing with algorithmic trading using <a href=\\\"https://www.backtrader.com/\\\">Backtrader</a>, which is a spectacular tool for experimenting with algorithmic trading strategies. This hobby could be considered a problem in itself, but that's not today's topic. A strategy I've been testing involves maintaining a list of S&#x26;P500 stocks, ranking them by some metrics, and making a portfolio out of the top 20% or so. Essentially, a really impersonal buy-and-hold strategy.</p>\\n<p>Unfortunately, this means I need to collect data on 500 stocks over my backtesting time range (5+ years). I would really prefer to use Backtrader's automatic Yahoo Finance data source <code>bt.feeds.YahooFinanceData</code>, but I don't want to send 500+ requests to Yahoo every time I tweak a single variable. On a list of just 16 stocks, it takes ~40 seconds to query 5 years of data and run the strategy. There has to be a better way.</p>\\n<h1>Enter <code>requests-cache</code>!</h1>\\n<p>Backtrader supports proxies (so we could set up a caching proxy), but under the hood, backtrader's <a href=\\\"https://github.com/mementum/backtrader/blob/master/backtrader/feeds/yahoo.py\\\">Yahoo feed</a> uses the <code>requests</code> module! This means we can solve our problem without even touching a proxy service or having to set up local SSL certificates to cache HTTPS.</p>\\n<p>All we need to do is run <code>pip install requests-cache</code> and add two lines of code to the start of our Backtrader script.</p>\\n<pre><code class=\\\"language-python\\\">import requests_cache\\nrequests_cache.install_cache('test_cache', expire_after=3600)\\n</code></pre>\\n<p>Now, requests-cache will automatically cache any requests made via the python <code>request</code> module in a file called <code>test_cache.sqlite</code>. Even HTTPS. With this little change, backtesting against 16 stocks over 5 years finishes in 10 seconds: an improvement of 75%!</p>\\n\",\"stripped\":\"requests-cache\"}},\"path\":\"blog/post/requests-cache\",\"sharedData\":{},\"siteData\":{}}");</script><script defer="" type="text/javascript" src="/templates/styles.3592562f.js"></script><script defer="" type="text/javascript" src="/templates/vendors~main.b60da2e7.js"></script><script defer="" type="text/javascript" src="/main.e9e3ebf8.js"></script></body></html>